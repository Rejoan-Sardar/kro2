apiVersion: kro.run/v1alpha1
kind: ResourceGraphDefinition
metadata:
  name: web-application
spec:
  parameters:
    appName:
      type: string
      description: "The name of the application"
      required: true
    region:
      type: string
      description: "The AWS region to deploy to"
      default: "us-west-2"
  resources:
    webserver:
      type: aws.ec2.Instance
      template:
        name: "{{ params.appName }}-webserver"
        instanceType: "t3.micro"
        region: "{{ params.region }}"
    database:
      type: aws.rds.Instance
      template:
        name: "{{ params.appName }}-db"
        engine: "mysql"
        region: "{{ params.region }}"
  relations:
    webserverToDb:
      type: NetworkConnection
      from: webserver
      to: database
      template:
        port: 3306